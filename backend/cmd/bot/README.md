# Go Bot для X-Cells

Этот бот представляет собой автономного клиента, который подключается к WebSocket серверу X-Cells и отправляет команды управления, имитируя поведение браузерного клиента.

## Возможности

- Подключение к WebSocket серверу через стандартный протокол
- Отправка команд `MOUSE_VECTOR` (имитирует управление мышью как в gamepad.js)
- Различные паттерны движения: случайный, круговой, линейный
- Периодическая отправка ping сообщений для поддержания соединения
- Статистика отправленных команд и полученных ответов
- Настраиваемые параметры через флаги командной строки
- Обработка всех типов сообщений от сервера (включая batch_update)

## Установка и запуск

### Предварительные требования

Убедитесь, что у вас установлен Go 1.21 или выше.

### Сборка

```bash
cd backend/cmd/bot
go build -o bot main.go
```

### Запуск

#### Базовый запуск
```bash
./bot
```

#### Запуск с параметрами
```bash
# Запуск с круговым паттерном движения на 60 секунд
./bot -pattern=circle -duration=60s

# Запуск с высокой частотой команд
./bot -rate=50ms -duration=30s

# Подключение к другому серверу
./bot -url=ws://example.com:8080/ws -id=mybot
```

## Параметры командной строки

- `-url` - URL WebSocket сервера (по умолчанию: `ws://localhost:8080/ws`)
- `-id` - ID бота для логирования (по умолчанию: `bot1`)
- `-pattern` - Паттерн движения: `random`, `circle`, `linear` (по умолчанию: `random`)
- `-duration` - Длительность работы бота (по умолчанию: `30s`)
- `-rate` - Частота отправки команд (по умолчанию: `100ms`)

## Паттерны движения

### Random (случайный)
Генерирует случайные векторы направления в 3D пространстве с случайным расстоянием.

### Circle (круговой)
Создает плавное круговое движение с постоянной скоростью.

### Linear (линейный)
Движение вперед-назад по оси Z с синусоидальным колебанием.

## Примеры использования

### Тестирование нагрузки
```bash
# Запуск 5 ботов одновременно на 2 минуты
./run_multiple_bots.sh 5 120s
```

### Отладка соединения
```bash
# Медленный бот для отладки
./bot -rate=1s -duration=60s -pattern=linear
```

### Стресс-тест
```bash
# Быстрый бот с высокой частотой команд
./bot -rate=25ms -duration=30s -pattern=random
```

## Логирование

Бот выводит подробные логи:
- Подключение/отключение
- Отправленные команды MOUSE_VECTOR с направлением и расстоянием
- Полученные ответы от сервера
- Статистику работы

## Совместимость

Бот полностью совместим с протоколом WebSocket сервера X-Cells и отправляет те же команды, что и браузерный клиент через gamepad.js.

## Структура команд

Бот отправляет команды в формате:
```json
{
  "type": "cmd",
  "cmd": "MOUSE_VECTOR",
  "client_time": 1640995200000,
  "data": {
    "x": 0.707,
    "y": 0.1,
    "z": 0.707,
    "distance": 45.5
  },
  "object_id": "mainPlayer1"
}
```

Где:
- `x`, `y`, `z` - нормализованный вектор направления
- `distance` - расстояние/сила импульса
- `object_id` - всегда "mainPlayer1" для совместимости с фронтом 