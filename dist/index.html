<!doctype html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>X-Cells</title><style>body { margin: 0; overflow: hidden; }
        canvas { display: block; }
        #loading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            font-family: Arial, sans-serif;
            z-index: 1000;
        }
        #progress-bar {
            width: 50%;
            height: 20px;
            background-color: #2a2a2a;
            border-radius: 10px;
            margin-top: 20px;
            overflow: hidden;
        }
        #progress {
            height: 100%;
            width: 0%;
            background-color: #4CAF50;
            transition: width 0.3s;
        }
        #error-message {
            color: #ff6b6b;
            margin-top: 20px;
            max-width: 80%;
            text-align: center;
        }</style><script>// Устанавливаем флаг, что Three.js уже загружен
        window.__THREE_LOADED__ = true;
        
        // Создаем заглушку для console.warn, чтобы блокировать сообщения о дубликатах
        const originalWarn = console.warn;
        console.warn = function(message) {
            if (message && typeof message === 'string' && message.includes('Multiple instances of Three.js')) {
                console.log('[Three] Предотвращено предупреждение о множественных импортах Three.js');
                return;
            }
            originalWarn.apply(console, arguments);
        };</script></head><body><div id="loading"><h2>Загрузка физики и ресурсов...</h2><div id="progress-bar"><div id="progress"></div></div><div id="error-message"></div></div><script>// Инициализируем глобальное пространство имен для нашего приложения
        window.XCells = {
            isAmmoReady: false,
            ammoCallbacks: []
        };

        // Функция для регистрации колбэков, которые будут вызваны после инициализации Ammo.js
        window.XCells.registerAmmoCallback = function(callback) {
            if (window.XCells.isAmmoReady) {
                // Если Ammo.js уже инициализирован, просто вызываем колбэк сразу
                callback();
            } else {
                // Иначе добавляем в очередь
                window.XCells.ammoCallbacks.push(callback);
            }
        };

        // Функция для запуска всех зарегистрированных колбэков
        window.XCells.runAmmoCallbacks = function() {
            console.log(`[App] Запуск ${window.XCells.ammoCallbacks.length} колбэков Ammo.js`);
            window.XCells.ammoCallbacks.forEach(callback => {
                try {
                    callback();
                } catch (error) {
                    console.error('[App] Ошибка в колбэке Ammo.js:', error);
                }
            });
            window.XCells.ammoCallbacks = [];
        };

        // Функция для обновления прогресс-бара
        function updateProgress(percent) {
            document.getElementById('progress').style.width = percent + '%';
        }

        // Функция отображения ошибки
        function showError(message) {
            const errorEl = document.getElementById('error-message');
            errorEl.innerHTML = `
                <div>${message}</div>
                <button onclick="window.location.reload()" style="margin-top: 15px; padding: 8px 16px; background: #4CAF50; color: white; border: none; border-radius: 4px; cursor: pointer;">
                    Попробовать снова
                </button>
            `;
        }

        // Функция для иницализации Ammo.js встроенным способом
        function initInlineAmmo() {
            console.log("[App] Инициализация встроенной версии Ammo.js");
            updateProgress(20);

            try {
                // Создаем минимальную версию Ammo.js для тестирования
                window.Ammo = (function() {
                    console.log("[Ammo] Инициализация простой версии Ammo.js");
                    
                    // Базовые классы для тестирования
                    function btVector3(x, y, z) {
                        this._x = x || 0;
                        this._y = y || 0;
                        this._z = z || 0;
                        
                        this.setValue = function(nx, ny, nz) {
                            this._x = nx;
                            this._y = ny;
                            this._z = nz;
                        };
                        
                        this.x = function() { return this._x; };
                        this.y = function() { return this._y; };
                        this.z = function() { return this._z; };
                    }
                    
                    function btQuaternion(x, y, z, w) {
                        this._x = x || 0;
                        this._y = y || 0;
                        this._z = z || 0;
                        this._w = w || 1;
                        
                        this.x = function() { return this._x; };
                        this.y = function() { return this._y; };
                        this.z = function() { return this._z; };
                        this.w = function() { return this._w; };
                    }
                    
                    function btTransform() {
                        this.position = new btVector3();
                        this.rotation = new btQuaternion();
                        
                        this.setIdentity = function() {
                            this.position = new btVector3(0, 0, 0);
                            this.rotation = new btQuaternion(0, 0, 0, 1);
                        };
                        
                        this.setOrigin = function(origin) {
                            this.position = origin;
                        };
                        
                        this.setRotation = function(rotation) {
                            this.rotation = rotation;
                        };
                        
                        this.getOrigin = function() {
                            return this.position;
                        };
                        
                        this.getRotation = function() {
                            return this.rotation;
                        };
                    }
                    
                    function btDefaultMotionState(transform) {
                        this.transform = transform || new btTransform();
                        
                        this.getWorldTransform = function(outTransform) {
                            outTransform.setOrigin(this.transform.getOrigin());
                            outTransform.setRotation(this.transform.getRotation());
                            return outTransform;
                        };
                        
                        this.setWorldTransform = function(transform) {
                            this.transform = transform;
                        };
                    }
                    
                    function btCollisionShape() {}
                    
                    function btSphereShape(radius) {
                        this.radius = radius;
                        
                        this.setMargin = function(margin) {};
                        
                        this.calculateLocalInertia = function(mass, inertia) {
                            inertia.setValue(mass * 0.4 * radius * radius, mass * 0.4 * radius * radius, mass * 0.4 * radius * radius);
                            return inertia;
                        };
                    }
                    
                    function btRigidBodyConstructionInfo(mass, motionState, shape, localInertia) {
                        this.mass = mass;
                        this.motionState = motionState;
                        this.shape = shape;
                        this.localInertia = localInertia;
                    }
                    
                    function btRigidBody(rbInfo) {
                        this.mass = rbInfo.mass;
                        this.motionState = rbInfo.motionState;
                        this.shape = rbInfo.shape;
                        this.localInertia = rbInfo.localInertia;
                        this.active = false;
                        
                        this.getMotionState = function() {
                            return this.motionState;
                        };
                        
                        this.setCenterOfMassTransform = function(transform) {
                            if (this.motionState) {
                                this.motionState.setWorldTransform(transform);
                            }
                        };
                        
                        this.activate = function(forceActivation) {
                            this.active = true;
                        };
                        
                        this.applyCentralImpulse = function(impulse) {
                            console.log("[Ammo] Applying impulse:", impulse.x(), impulse.y(), impulse.z());
                            // В реальном Ammo.js здесь был бы код для применения импульса
                        };
                        
                        this.setCollisionFlags = function(flags) {};
                        this.setRestitution = function(restitution) {};
                        this.setFriction = function(friction) {};
                    }
                    
                    function btHeightfieldTerrainShape(width, length, heightData, heightScale, minHeight, maxHeight, upAxis, flipQuadEdges) {
                        this.width = width;
                        this.length = length;
                        this.heightData = heightData;
                        
                        this.setMargin = function(margin) {};
                        this.setLocalScaling = function(scaling) {};
                    }
                    
                    function btDefaultCollisionConfiguration() {}
                    
                    function btCollisionDispatcher(config) {}
                    
                    function btDbvtBroadphase() {}
                    
                    function btSequentialImpulseConstraintSolver() {}
                    
                    function btDiscreteDynamicsWorld(dispatcher, broadphase, solver, config) {
                        this.bodies = [];
                        
                        this.setGravity = function(gravity) {};
                        
                        this.addRigidBody = function(body) {
                            this.bodies.push(body);
                        };
                        
                        this.removeRigidBody = function(body) {
                            const index = this.bodies.indexOf(body);
                            if (index !== -1) {
                                this.bodies.splice(index, 1);
                            }
                        };
                        
                        this.stepSimulation = function(timeStep, maxSubSteps, fixedTimeStep) {
                            // В реальном Ammo.js здесь был бы код для симуляции
                        };
                    }
                    
                    function destroy(obj) {
                        // Просто заглушка для совместимости с API
                        console.log("[Ammo] Destroying object:", obj);
                    }
                    
                    return {
                        btVector3: btVector3,
                        btQuaternion: btQuaternion,
                        btTransform: btTransform,
                        btDefaultMotionState: btDefaultMotionState,
                        btSphereShape: btSphereShape,
                        btRigidBody: btRigidBody,
                        btRigidBodyConstructionInfo: btRigidBodyConstructionInfo,
                        btHeightfieldTerrainShape: btHeightfieldTerrainShape,
                        btDefaultCollisionConfiguration: btDefaultCollisionConfiguration,
                        btCollisionDispatcher: btCollisionDispatcher,
                        btDbvtBroadphase: btDbvtBroadphase,
                        btSequentialImpulseConstraintSolver: btSequentialImpulseConstraintSolver,
                        btDiscreteDynamicsWorld: btDiscreteDynamicsWorld,
                        destroy: destroy
                    };
                })();

                // Создаем копию для совместимости
                window.AmmoLib = window.Ammo;
                
                // Устанавливаем флаг готовности
                window.XCells.isAmmoReady = true;
                
                // Запускаем событие готовности Ammo.js
                const event = new CustomEvent('ammojs-ready');
                window.dispatchEvent(event);
                
                console.log("[App] Встроенная версия Ammo.js успешно инициализирована");
                updateProgress(80);
                
                // Тестируем
                const vec = new window.Ammo.btVector3(0, 0, 0);
                console.log("[App] Тестовый объект btVector3 создан успешно");
                
                // Вызываем зарегистрированные колбэки
                window.XCells.runAmmoCallbacks();
                
                updateProgress(100);
                
                // Удаляем экран загрузки
                document.getElementById('loading').style.display = 'none';
                
                return true;
            } catch (error) {
                console.error("[App] Ошибка при инициализации встроенной версии Ammo.js:", error);
                showError(`Ошибка инициализации физики: ${error.message}`);
                return false;
            }
        }

        // Запускаем загрузку Ammo.js и скрипта приложения
        window.addEventListener('DOMContentLoaded', async () => {
            try {
                // Инициализируем встроенную версию Ammo.js
                const success = initInlineAmmo();
                
                if (success) {
                    // Логируем состояние перед загрузкой основного скрипта
                    console.log("[App] Состояние перед загрузкой основного скрипта:");
                    console.log("- window.Ammo:", !!window.Ammo);
                    console.log("- window.AmmoLib:", !!window.AmmoLib);
                    console.log("- window.XCells.isAmmoReady:", window.XCells.isAmmoReady);
                    
                    // Загружаем основной скрипт приложения
                    const appScript = document.createElement('script');
                    appScript.src = 'bundle.3f25a358428cfa803baf.js'; // Вставляется через HtmlWebpackPlugin
                    appScript.async = true;
                    appScript.defer = true;
                    document.body.appendChild(appScript);
                }
            } catch (error) {
                console.error("[App] Критическая ошибка при инициализации:", error);
            }
        });</script><script defer="defer" src="bundle.3f25a358428cfa803baf.js"></script><script defer="defer" src="bundle.b224b15b9a7fb13870da.js"></script></body></html>